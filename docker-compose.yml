services:
  postfix:
    image: registry.ddos-guard.net/postfix:latest
    container_name: postfix
    restart: unless-stopped
    volumes:
      - /storage/postfix-mail-sender/mail-templates:/root/mail-templates
    ports:
      - 2525:25
  alias:
    image: registry.ddos-guard.net/alpine:3.18
    volumes:
      - /usr/local/bin:/usr/local/bin
    depends_on:
      - postfix
    entrypoint: ["/bin/sh", "-c"]
    command:
      - |
        if [ ! -f /usr/local/bin/sendmail ]; then
          touch /usr/local/bin/sendmail && \
          echo 'cp "$2" /storage/postfix-mail-sender/mail-templates/' >> /usr/local/bin/sendmail && \
          echo 'sudo docker exec postfix sh -c "sendmail -f $1 -t < ~/mail-templates/$(basename $2)"' >> /usr/local/bin/sendmail && \
          echo 'rm /storage/postfix-mail-sender/mail-templates/$(basename $2)' >> /usr/local/bin/sendmail && \
          chmod +x /usr/local/bin/sendmail
        else \
          echo "sendmail already exists, skipping script creation."; \
        fi
